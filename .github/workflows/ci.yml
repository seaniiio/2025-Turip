name: CI Build and Test

on:
  pull_request:
    types: [ closed ]
    branches: [ develop ]
    paths:
      - 'backend/**'

jobs:
  build_and_test:
     runs-on: ubuntu-latest
     
     defaults:
      run:
        working-directory: backend
        
     steps: 
     - name: Checkout code
       uses: actions/checkout@v4

     - name: Set up Gradle
       uses: gradle/actions/setup-gradle@v3
             
     - name: Grant execute permission for gradlew
       run: chmod +x gradlew

     - name: Set up JDK 21
       uses: actions/setup-java@v4
       with:
         java-version: '21'
         distribution: 'temurin'
         cache: 'gradle'
       
     - name: Build with Gradle
       run: ./gradlew clean build -x test

     - name: Run Unit Tests
       run: ./gradlew test

     - name: Upload Jar
       uses: actions/upload-artifact@v4
       with:
         name: spring-boot-app
         path: build/libs/*.jar
         retention-days: 5
